<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blackonstar AI â€” Referral Program</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: #0a0a0a;
      color: #fff;
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Main Content Styles */
    #main-content {
      display: none;
    }

    /* Header Styles */
    header {
      background: rgba(18, 18, 18, 0.9);
      backdrop-filter: blur(10px);
      padding: 15px 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid rgba(0, 255, 213, 0.2);
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(45deg, #00a2ff, #00ffd5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .hamburger {
      font-size: 24px;
      cursor: pointer;
      display: none;
    }

    /* Navigation */
    nav ul {
      display: flex;
      list-style: none;
      gap: 30px;
    }

    nav ul li a {
      color: #aaa;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav ul li a:hover {
      color: #00ffd5;
    }

    nav ul li a.active {
      color: #00ffd5;
    }

    /* Referral Section */
    .referral-section {
      padding: 40px 5%;
      max-width: 1000px;
      margin: 0 auto;
    }

    .section-title {
      text-align: center;
      font-size: 28px;
      margin-bottom: 30px;
      color: #00ffd5;
      position: relative;
    }

    .section-title::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: linear-gradient(45deg, #00a2ff, #00ffd5);
      margin: 10px auto;
      border-radius: 2px;
    }

    /* Referral Card */
    .referral-card {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 40px;
      border: 1px solid rgba(0, 255, 213, 0.3);
      box-shadow: 0 8px 32px rgba(0, 255, 213, 0.1);
    }

    .referral-code-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 25px;
    }

    .code-label {
      font-size: 18px;
      margin-bottom: 15px;
      color: #aaa;
    }

    .code-display {
      font-size: 28px;
      font-weight: 700;
      background: rgba(0, 255, 213, 0.1);
      padding: 15px 30px;
      border-radius: 12px;
      letter-spacing: 3px;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 255, 213, 0.3);
      width: 100%;
      text-align: center;
      user-select: all;
    }

    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .share-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 14px;
    }

    .share-btn i {
      font-size: 18px;
    }

    .copy-btn {
      background: linear-gradient(45deg, #00a2ff, #00ffd5);
      color: #000;
    }

    .whatsapp-btn {
      background: #25D366;
      color: white;
    }

    .telegram-btn {
      background: #0088cc;
      color: white;
    }

    .facebook-btn {
      background: #1877F2;
      color: white;
    }

    .messenger-btn {
      background: #0099FF;
      color: white;
    }

    .share-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      background: rgba(0, 255, 213, 0.9);
      color: #000;
      font-weight: 600;
      transform: translateX(200%);
      transition: transform 0.3s ease;
      z-index: 2000;
    }

    .notification.show {
      transform: translateX(0);
    }

    /* Stats Section */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      border: 1px solid rgba(0, 255, 213, 0.2);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
      background: linear-gradient(45deg, #00a2ff, #00ffd5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      color: #aaa;
      font-size: 16px;
    }

    /* Referrals List */
    .referrals-list {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 40px;
      border: 1px solid rgba(0, 255, 213, 0.2);
    }

    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .list-title {
      font-size: 22px;
      color: #00ffd5;
    }

    .referral-item {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .referral-item:last-child {
      border-bottom: none;
    }

    .referral-name {
      font-weight: 500;
    }

    .referral-date {
      color: #aaa;
      font-size: 14px;
    }

    .no-referrals {
      text-align: center;
      padding: 30px;
      color: #777;
    }

    /* Leaderboard */
    .leaderboard {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 15px;
      padding: 25px;
      border: 1px solid rgba(0, 255, 213, 0.2);
    }

    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .leaderboard-title {
      font-size: 22px;
      color: #00ffd5;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .leaderboard-item:last-child {
      border-bottom: none;
    }

    .rank {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-weight: 700;
      margin-right: 15px;
    }

    .rank-1 {
      background: linear-gradient(45deg, #FFD700, #FFA500);
      color: #000;
    }

    .rank-2 {
      background: linear-gradient(45deg, #C0C0C0, #A9A9A9);
      color: #000;
    }

    .rank-3 {
      background: linear-gradient(45deg, #CD7F32, #A0522D);
      color: #000;
    }

    .rank-default {
      background: rgba(0, 255, 213, 0.2);
      color: #00ffd5;
    }

    .leaderboard-info {
      flex: 1;
    }

    .leaderboard-name {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .leaderboard-stats {
      display: flex;
      gap: 15px;
    }

    .stat-badge {
      background: rgba(0, 255, 213, 0.1);
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
      color: #00ffd5;
    }

    /* Badge System */
    .badge-section {
      background: rgba(30, 30, 30, 0.7);
      border-radius: 15px;
      padding: 25px;
      margin-top: 20px;
      border: 1px solid rgba(0, 255, 213, 0.2);
    }

    .badge-title {
      font-size: 22px;
      color: #00ffd5;
      margin-bottom: 20px;
      text-align: center;
    }

    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 20px;
    }

    .badge {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .badge-icon {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      font-size: 36px;
      margin-bottom: 10px;
      background: rgba(0, 255, 213, 0.1);
      border: 2px dashed rgba(0, 255, 213, 0.3);
    }

    .badge-name {
      font-size: 14px;
      font-weight: 500;
    }

    .badge-locked {
      opacity: 0.4;
    }

    /* Footer Navigation */
    .footer-nav {
      background: rgba(18, 18, 18, 0.95);
      padding: 20px 5%;
      display: flex;
      justify-content: space-around;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      border-top: 1px solid rgba(0, 255, 213, 0.2);
      z-index: 1000;
    }

    .footer-nav a {
      color: #aaa;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      transition: color 0.3s ease;
    }

    .footer-nav a:hover,
    .footer-nav a.active {
      color: #00ffd5;
    }

    .footer-nav i {
      font-size: 20px;
      margin-bottom: 5px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .hamburger {
        display: block;
      }

      nav ul {
        display: none;
        position: absolute;
        top: 70px;
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.95);
        flex-direction: column;
        padding: 20px;
        gap: 15px;
        border-bottom: 1px solid rgba(0, 255, 213, 0.2);
      }

      nav ul.show {
        display: flex;
      }

      .share-buttons {
        flex-direction: column;
        align-items: center;
      }

      .share-btn {
        width: 100%;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Hamburger Menu Animation */
    .hamburger.active span:nth-child(1) {
      transform: translateY(9px) rotate(45deg);
    }

    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }

    .hamburger.active span:nth-child(3) {
      transform: translateY(-9px) rotate(-45deg);
    }

    .hamburger span {
      display: block;
      width: 25px;
      height: 3px;
      background: #00ffd5;
      margin: 5px 0;
      transition: 0.3s;
    }
  </style>
</head>
<body>
  <!-- Notification -->
  <div class="notification" id="notification">Copied to clipboard!</div>

  <!-- Main Content -->
  <div id="main-content">
    <!-- Header -->
    <header>
      <div class="logo">Blackonstar AI</div>
      <div class="hamburger" id="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <nav>
        <ul id="nav-menu">
          <li><a href="home.html"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="chat.html"><i class="fas fa-robot"></i> Chat AI</a></li>
          <li><a href="referral.html" class="active"><i class="fas fa-gift"></i> Referral</a></li>
          <li><a href="dashboard.html"><i class="fas fa-chart-line"></i> Dashboard</a></li>
        </ul>
      </nav>
    </header>

    <!-- Referral Section -->
    <section class="referral-section">
      <h2 class="section-title">Referral Program</h2>
      
      <!-- Referral Card -->
      <div class="referral-card">
        <div class="referral-code-box">
          <div class="code-label">Your Referral Code</div>
          <div class="code-display" id="referral-code">Loading...</div>
          <div class="code-label">Share with friends and earn 50 BK tokens per referral!</div>
        </div>
        
        <div class="share-buttons">
          <button class="share-btn copy-btn" id="copy-btn">
            <i class="fas fa-copy"></i> Copy Code
          </button>
          <button class="share-btn whatsapp-btn" id="whatsapp-btn">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </button>
          <button class="share-btn telegram-btn" id="telegram-btn">
            <i class="fab fa-telegram"></i> Telegram
          </button>
          <button class="share-btn facebook-btn" id="facebook-btn">
            <i class="fab fa-facebook-f"></i> Facebook
          </button>
          <button class="share-btn messenger-btn" id="messenger-btn">
            <i class="fab fa-facebook-messenger"></i> Messenger
          </button>
        </div>
      </div>
      
      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Referrals</div>
          <div class="stat-value" id="total-referrals">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tokens Earned</div>
          <div class="stat-value" id="tokens-earned">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Your Rank</div>
          <div class="stat-value" id="your-rank">#-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tier Level</div>
          <div class="stat-value" id="tier-level">-</div>
        </div>
      </div>
      
      <!-- Referrals List -->
      <div class="referrals-list">
        <div class="list-header">
          <h3 class="list-title">Recent Referrals</h3>
        </div>
        <div id="referrals-container">
          <div class="no-referrals" id="no-referrals">No referrals yet. Start sharing your code!</div>
          <div id="referrals-list"></div>
        </div>
      </div>
      
      <!-- Leaderboard -->
      <div class="leaderboard">
        <div class="leaderboard-header">
          <h3 class="leaderboard-title">Top Referrers</h3>
        </div>
        <div id="leaderboard-list">
          <!-- Leaderboard items will be populated here -->
        </div>
      </div>
      
      <!-- Badge System -->
      <div class="badge-section">
        <h3 class="badge-title">Referral Achievements</h3>
        <div class="badges-grid" id="badges-container">
          <!-- Badges will be populated here -->
        </div>
      </div>
    </section>

    <!-- Footer Navigation -->
    <div class="footer-nav">
      <a href="home.html">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </a>
      <a href="chat.html">
        <i class="fas fa-robot"></i>
        <span>Chat AI</span>
      </a>
      <a href="referral.html" class="active">
        <i class="fas fa-gift"></i>
        <span>Referral</span>
      </a>
      <a href="dashboard.html">
        <i class="fas fa-chart-line"></i>
        <span>Dashboard</span>
      </a>
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const SUPABASE_URL = 'https://nnixqnoxlhdncoppukvw.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5uaXhxbm94bGhkbmNvcHB1a3Z3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MzMyNjIsImV4cCI6MjA3NjQwOTI2Mn0.F2vIAkiX29Bqe7jpJhYPRzjUNJ3n0Fs3Emca-8I9JuE'

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
    
    // DOM Elements
    const mainContent = document.getElementById('main-content')
    const referralCodeElement = document.getElementById('referral-code')
    const totalReferralsElement = document.getElementById('total-referrals')
    const tokensEarnedElement = document.getElementById('tokens-earned')
    const yourRankElement = document.getElementById('your-rank')
    const tierLevelElement = document.getElementById('tier-level')
    const referralsContainer = document.getElementById('referrals-container')
    const noReferralsElement = document.getElementById('no-referrals')
    const referralsList = document.getElementById('referrals-list')
    const leaderboardList = document.getElementById('leaderboard-list')
    const badgesContainer = document.getElementById('badges-container')
    const notification = document.getElementById('notification')
    const hamburgerMenu = document.getElementById('hamburger-menu')
    const navMenu = document.getElementById('nav-menu')
    
    // Button Elements
    const copyBtn = document.getElementById('copy-btn')
    const whatsappBtn = document.getElementById('whatsapp-btn')
    const telegramBtn = document.getElementById('telegram-btn')
    const facebookBtn = document.getElementById('facebook-btn')
    const messengerBtn = document.getElementById('messenger-btn')
    
    // User data
    let currentUser = null
    let referralCode = null
    
    // Badges Configuration
    const badges = [
      { name: "Starter", minReferrals: 0, icon: "fas fa-user" },
      { name: "Recruiter", minReferrals: 5, icon: "fas fa-users" },
      { name: "Influencer", minReferrals: 20, icon: "fas fa-crown" },
      { name: "Champion", minReferrals: 50, icon: "fas fa-trophy" },
      { name: "Legend", minReferrals: 100, icon: "fas fa-medal" }
    ]
    
    // Initialize
    async function init() {
      try {
        // Check authentication silently
        const { data: { user }, error } = await supabase.auth.getUser()
        
        if (error || !user) {
          // Redirect to signup if not authenticated
          window.location.href = 'signup.html'
          return
        }
        
        currentUser = user
        
        // Fetch user referral data
        await fetchUserData()
        
        // Fetch leaderboard
        await fetchLeaderboard()
        
        // Show main content
        mainContent.style.display = 'block'
        
      } catch (err) {
        console.error('Initialization error:', err)
        window.location.href = 'signup.html'
      }
    }
    
    // Fetch user data
    async function fetchUserData() {
      try {
        // Fetch user referral code and stats
        const { data: userData, error: userError } = await supabase
          .from('users')
          .select('referral_code, referral_count, bk_tokens')
          .eq('id', currentUser.id)
          .single()
        
        if (userError) throw userError
        
        referralCode = userData.referral_code
        referralCodeElement.textContent = referralCode
        
        // Update stats
        totalReferralsElement.textContent = userData.referred_count || 0
        tokensEarnedElement.textContent = userData.bk_tokens || 0
        
        // Determine tier level
        const referralCount = userData.referred_count || 0
        let tier = "Novice"
        if (referralCount >= 100) tier = "Legend"
        else if (referralCount >= 50) tier = "Champion"
        else if (referralCount >= 20) tier = "Influencer"
        else if (referralCount >= 5) tier = "Recruiter"
        tierLevelElement.textContent = tier
        
        // Fetch referrals list
        await fetchReferrals()
        
        // Render badges
        renderBadges(referralCount)
        
      } catch (err) {
        console.error('Error fetching user data:', err)
      }
    }
    
    // Fetch referrals list
    async function fetchReferrals() {
      try {
        const { data: referrals, error } = await supabase
          .from('users')
          .select('display_name, created_at')
          .eq('invitation_code', referralCode)
          .order('created_at', { ascending: false })
          .limit(10)
        
        if (error) throw error
        
        if (referrals.length === 0) {
          noReferralsElement.style.display = 'block'
          referralsList.innerHTML = ''
          return
        }
        
        noReferralsElement.style.display = 'none'
        referralsList.innerHTML = ''
        
        referrals.forEach(referral => {
          const referralItem = document.createElement('div')
          referralItem.className = 'referral-item'
          
          const date = new Date(referral.created_at).toLocaleDateString()
          
          referralItem.innerHTML = `
            <div class="referral-name">${referral.display_name || 'New User'}</div>
            <div class="referral-date">${date}</div>
          `
          
          referralsList.appendChild(referralItem)
        })
        
      } catch (err) {
        console.error('Error fetching referrals:', err)
      }
    }
    
    // Fetch leaderboard
    async function fetchLeaderboard() {
      try {
        const { data: leaders, error } = await supabase
          .from('users')
          .select('display_name, referral_count')
          .order('referral_count', { ascending: false })
          .limit(10)
        
        if (error) throw error
        
        leaderboardList.innerHTML = ''
        
        if (leaders.length === 0) {
          leaderboardList.innerHTML = '<div class="no-referrals">No data available</div>'
          return
        }
        
        leaders.forEach((leader, index) => {
          const leaderboardItem = document.createElement('div')
          leaderboardItem.className = 'leaderboard-item'
          
          let rankClass = 'rank-default'
          if (index === 0) rankClass = 'rank-1'
          else if (index === 1) rankClass = 'rank-2'
          else if (index === 2) rankClass = 'rank-3'
          
          leaderboardItem.innerHTML = `
            <div class="rank ${rankClass}">${index + 1}</div>
            <div class="leaderboard-info">
              <div class="leaderboard-name">${leader.display_name || 'Anonymous'}</div>
              <div class="leaderboard-stats">
                <div class="stat-badge">${leader.referred_count} referrals</div>
              </div>
            </div>
          `
          
          leaderboardList.appendChild(leaderboardItem)
        })
        
        // Set user's rank
        const userRank = leaders.findIndex(leader => 
          leader.display_name === (currentUser.display_name || currentUser.email)
        )
        
        yourRankElement.textContent = userRank >= 0 ? `#${userRank + 1}` : '#-'
        
      } catch (err) {
        console.error('Error fetching leaderboard:', err)
      }
    }
    
    // Render badges
    function renderBadges(referralCount) {
      badgesContainer.innerHTML = ''
      
      badges.forEach(badge => {
        const badgeElement = document.createElement('div')
        badgeElement.className = `badge ${referralCount < badge.minReferrals ? 'badge-locked' : ''}`
        
        badgeElement.innerHTML = `
          <div class="badge-icon">
            <i class="${badge.icon}"></i>
          </div>
          <div class="badge-name">${badge.name}</div>
        `
        
        badgesContainer.appendChild(badgeElement)
      })
    }
    
    // Show notification
    function showNotification(message) {
      notification.textContent = message
      notification.classList.add('show')
      
      setTimeout(() => {
        notification.classList.remove('show')
      }, 3000)
    }
    
    // Copy referral code to clipboard
    function copyToClipboard() {
      navigator.clipboard.writeText(referralCode).then(() => {
        showNotification('Referral code copied to clipboard!')
      }).catch(err => {
        console.error('Failed to copy:', err)
        showNotification('Failed to copy code')
      })
    }
    
    // Share functions
    function shareToWhatsApp() {
      const message = `Join me on Blackonstar AI and earn tokens! Use my referral code: ${referralCode}\n\nSign up here: https://yourdomain.com/signup.html`
      const url = `https://wa.me/?text=${encodeURIComponent(message)}`
      window.open(url, '_blank')
    }
    
    function shareToTelegram() {
      const message = `Join me on Blackonstar AI and earn tokens! Use my referral code: ${referralCode}\n\nSign up here: https://yourdomain.com/signup.html`
      const url = `https://t.me/share/url?url=${encodeURIComponent('https://earn.blackonster-ai.kesug.com/')}&text=${encodeURIComponent(message)}`
      window.open(url, '_blank')
    }
    
    function shareToFacebook() {
      const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://earn.blackonster-ai.kesug.com')}`
      window.open(url, '_blank')
    }
    
    function shareToMessenger() {
      const url = `https://www.facebook.com/dialog/send?app_id=YOUR_APP_ID&link=${encodeURIComponent('https://earn.blackonster-ai.kesug.com')}&redirect_uri=${encodeURIComponent('https://yourdomain.com')}`
      window.open(url, '_blank')
    }
    
    // Event Listeners
    copyBtn.addEventListener('click', copyToClipboard)
    whatsappBtn.addEventListener('click', shareToWhatsApp)
    telegramBtn.addEventListener('click', shareToTelegram)
    facebookBtn.addEventListener('click', shareToFacebook)
    messengerBtn.addEventListener('click', shareToMessenger)
    
    // Hamburger menu toggle
    hamburgerMenu.addEventListener('click', () => {
      hamburgerMenu.classList.toggle('active')
      navMenu.classList.toggle('show')
    })
    
    // Close menu when clicking a link
    document.querySelectorAll('#nav-menu a').forEach(link => {
      link.addEventListener('click', () => {
        hamburgerMenu.classList.remove('active')
        navMenu.classList.remove('show')
      })
    })
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', init)
  </script>
</body>
</html>
